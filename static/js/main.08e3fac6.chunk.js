(this.webpackJsonpjerrycoin=this.webpackJsonpjerrycoin||[]).push([[0],{100:function(t,n,e){},102:function(t,n){},103:function(t,n){},147:function(t,n,e){"use strict";e.r(n);var o,i=e(0),r=e.n(i),u=e(59),a=e.n(u),c=(e(68),e(6)),l=e(60),s=e.n(l),d=(e(99),e(100),e(23)),f=(e(35),e(2)),x=e(8),h=e(24),g=new d.ec("secp256k1"),v=function t(n,e,o,i){Object(x.a)(this,t),this.txOutId=void 0,this.txOutIndex=void 0,this.address=void 0,this.amount=void 0,this.txOutId=n,this.txOutIndex=e,this.address=o,this.amount=i},O=function t(){Object(x.a)(this,t),this.txOutId=void 0,this.txOutIndex=void 0,this.signature=void 0},m=function t(n,e){Object(x.a)(this,t),this.address=void 0,this.amount=void 0,this.address=n,this.amount=e},p=function t(){Object(x.a)(this,t),this.id=void 0,this.txIns=void 0,this.txOuts=void 0},y=function(t){var n=t.txIns.map((function(t){return t.txOutId+t.txOutIndex})).reduce((function(t,n){return t+n}),""),e=t.txOuts.map((function(t){return t.address+t.amount})).reduce((function(t,n){return t+n}),"");return h.SHA256(n+e).toString()},b=function(t,n){if(!R(t))return!1;if(y(t)!==t.id)return console.log("invalid tx id: "+t.id),!1;if(!t.txIns.map((function(e){return S(e,t,n)})).reduce((function(t,n){return t&&n}),!0))return console.log("some of the txIns are invalid in tx: "+t.id),!1;var e=t.txIns.map((function(t){return E(t,n)})).reduce((function(t,n){return t+n}),0);return t.txOuts.map((function(t){return t.amount})).reduce((function(t,n){return t+n}),0)===e||(console.log("totalTxOutValues !== totalTxInValues in tx: "+t.id),!1)},I=function(t,n){return null==t?(console.log("the first transaction in the block must be coinbase transaction"),!1):y(t)!==t.id?(console.log("invalid coinbase tx id: "+t.id),!1):1===t.txIns.length?t.txIns[0].txOutIndex!==n?(console.log("the txIn signature in coinbase tx must be the block height"),!1):1!==t.txOuts.length?(console.log("invalid number of txOuts in coinbase transaction"),!1):50===t.txOuts[0].amount||(console.log("invalid coinbase amount in coinbase transaction"),!1):void console.log("one txIn must be specified in the coinbase transaction")},S=function(t,n,e){var o=e.find((function(n){return n.txOutId===t.txOutId&&n.txOutIndex===t.txOutIndex}));if(null==o)return console.log("referenced txOut not found: "+JSON.stringify(t)),!1;var i=o.address;return!!g.keyFromPublic(i,"hex").verify(n.id,t.signature)||(console.log("invalid txIn signature: %s txId: %s address: %s",t.signature,n.id,o.address),!1)},E=function(t,n){return k(t.txOutId,t.txOutIndex,n).amount},k=function(t,n,e){return e.find((function(e){return e.txOutId===t&&e.txOutIndex===n}))},w=function(t,n){var e=new p,o=new O;return o.signature="",o.txOutId="",o.txOutIndex=n,e.txIns=[o],e.txOuts=[new m(t,50)],e.id=y(e),e},j=function(t,n,e){return function(t,n,e){var o=t[0];return I(o,e)?t.slice(1).map((function(t){return b(t,n)})).reduce((function(t,n){return t&&n}),!0):(console.log("invalid coinbase transaction: "+JSON.stringify(o)),!1)}(t,n,e)?function(t,n){var e=t.map((function(t){return t.txOuts.map((function(n,e){return new v(t.id,e,n.address,n.amount)}))})).reduce((function(t,n){return t.concat(n)}),[]),o=t.map((function(t){return t.txIns})).reduce((function(t,n){return t.concat(n)}),[]).map((function(t){return new v(t.txOutId,t.txOutIndex,"",0)}));return n.filter((function(t){return!k(t.txOutId,t.txOutIndex,o)})).concat(e)}(t,n):(console.log("invalid block transactions"),null)},N=function(t){return Array.from(t,(function(t){return("0"+(255&t).toString(16)).slice(-2)})).join("")},P=function(t){return g.keyFromPrivate(t,"hex").getPublic().encode("hex")},T=function(t){return null==t?(console.log("txIn is null"),!1):"string"!==typeof t.signature?(console.log("invalid signature type in txIn"),!1):"string"!==typeof t.txOutId?(console.log("invalid txOutId type in txIn"),!1):"number"===typeof t.txOutIndex||(console.log("invalid txOutIndex type in txIn"),!1)},A=function(t){return null==t?(console.log("txOut is null"),!1):"string"!==typeof t.address?(console.log("invalid address type in txOut"),!1):_(t.address)?"number"===typeof t.amount||(console.log("invalid amount type in txOut"),!1):(console.log("invalid TxOut address"),!1)},R=function(t){return"string"!==typeof t.id?(console.log("transactionId missing"),!1):t.txIns instanceof Array?!!t.txIns.map(T).reduce((function(t,n){return t&&n}),!0)&&(t.txOuts instanceof Array?!!t.txOuts.map(A).reduce((function(t,n){return t&&n}),!0):(console.log("invalid txIns type in transaction"),!1)):(console.log("invalid txIns type in transaction"),!1)},_=function(t){return 130!==t.length?(console.log(t),console.log("invalid public key length"),!0):null===t.match("^[a-fA-F0-9]+$")?(console.log("public key must contain only hex characters"),!1):!!t.startsWith("04")||(console.log("public key must start with 04"),!1)},C=e(61),L=e.n(C),J=new d.ec("secp256k1"),H=(Object({NODE_ENV:"production",PUBLIC_URL:"/jerrycoin"}).PRIVATE_KEY,function(){var t=L.a.get("jerry");return console.log(t),t}),U=function(){var t=H(),n=J.keyFromPrivate(t,"hex");return console.log(n.getPublic()),n.getPublic().encode("hex")},B=function(){return J.genKeyPair().getPrivate().toString(16)},Y=function(t,n){return f.filter(n,(function(n){return n.address===t}))},Q=function(t,n,e,o,i){console.log("txPool: %s",JSON.stringify(i));var r=P(e),u=function(t,n){var e=0,o=[],i=!0,r=!1,u=void 0;try{for(var a,c=n[Symbol.iterator]();!(i=(a=c.next()).done);i=!0){var l=a.value;if(o.push(l),(e+=l.amount)>=t)return{includedUnspentTxOuts:o,leftOverAmount:e-t}}}catch(d){r=!0,u=d}finally{try{i||null==c.return||c.return()}finally{if(r)throw u}}var s="Cannot create transaction from the available unspent transaction outputs. Required amount:"+t+". Available unspentTxOuts:"+JSON.stringify(n);throw Error(s)}(n,function(t,n){var e=f(n).map((function(t){return t.txIns})).flatten().value(),o=[],i=!0,r=!1,u=void 0;try{for(var a,c=function(){var t=a.value;void 0===f.find(e,(function(n){return n.txOutIndex===t.txOutIndex&&n.txOutId===t.txOutId}))||o.push(t)},l=t[Symbol.iterator]();!(i=(a=l.next()).done);i=!0)c()}catch(s){r=!0,u=s}finally{try{i||null==l.return||l.return()}finally{if(r)throw u}}return f.without.apply(f,[t].concat(o))}(o.filter((function(t){return t.address===r})),i)),a=u.includedUnspentTxOuts,c=u.leftOverAmount,l=a.map((function(t){var n=new O;return n.txOutId=t.txOutId,n.txOutIndex=t.txOutIndex,n})),s=new p;return s.txIns=l,s.txOuts=function(t,n,e,o){var i=new m(t,e);return 0===o?[i]:[i,new m(n,o)]}(t,r,n,c),s.id=y(s),s.txIns=s.txIns.map((function(t,n){return t.signature=function(t,n,e,o){var i=t.txIns[n],r=t.id,u=k(i.txOutId,i.txOutIndex,o);if(null==u)throw console.log("could not find referenced txOut"),Error();var a=u.address;if(P(e)!==a)throw console.log("trying to sign an input with private key that does not match the address that is referenced in txIn"),Error();var c=g.keyFromPrivate(e,"hex");return N(c.sign(r).toDER())}(s,n,e,o),t})),s},D=(e(36),[]),F=function(){return f.cloneDeep(D)},W=function(t){D=t},K=function(t,n){if(!b(t,n))throw Error("Trying to add invalid tx to pool");if(!M(t,D))throw Error("Trying to add invalid tx to pool");console.log("adding to txPool: %s",JSON.stringify(t)),D.push(t)},V=function(t,n){return void 0!==n.find((function(n){return n.txOutId===t.txOutId&&n.txOutIndex===t.txOutIndex}))},q=function(t){var n=[],e=!0,o=!1,i=void 0;try{for(var r,u=D[Symbol.iterator]();!(e=(r=u.next()).done);e=!0){var a=r.value,c=!0,l=!1,s=void 0;try{for(var d,x=a.txIns[Symbol.iterator]();!(c=(d=x.next()).done);c=!0){var h=d.value;if(!V(h,t)){n.push(a);break}}}catch(g){l=!0,s=g}finally{try{c||null==x.return||x.return()}finally{if(l)throw s}}}}catch(g){o=!0,i=g}finally{try{e||null==u.return||u.return()}finally{if(o)throw i}}n.length>0&&(console.log("removing the following transactions from txPool: %s",JSON.stringify(n)),D=f.without.apply(f,[D].concat(n)))},M=function(t,n){var e=f(n).map((function(t){return t.txIns})).flatten().value(),o=function(t,n){return f.find(e,(function(t){return n.txOutIndex===t.txOutIndex&&n.txOutId===t.txOutId}))},i=!0,r=!1,u=void 0;try{for(var a,c=t.txIns[Symbol.iterator]();!(i=(a=c.next()).done);i=!0){if(o(0,a.value))return console.log("txIn already found in the txPool"),!1}}catch(l){r=!0,u=l}finally{try{i||null==c.return||c.return()}finally{if(r)throw u}}return!0},$=[];!function(t){t[t.QUERY_LATEST=0]="QUERY_LATEST",t[t.QUERY_ALL=1]="QUERY_ALL",t[t.RESPONSE_BLOCKCHAIN=2]="RESPONSE_BLOCKCHAIN",t[t.QUERY_TRANSACTION_POOL=3]="QUERY_TRANSACTION_POOL",t[t.RESPONSE_TRANSACTION_POOL=4]="RESPONSE_TRANSACTION_POOL"}(o||(o={}));var z=function(t,n){return t.send(JSON.stringify(n))},G=function(t){return $.forEach((function(n){return z(n,t)}))},X=function(){return{type:o.RESPONSE_BLOCKCHAIN,data:JSON.stringify([st()])}},Z=function(){return{type:o.RESPONSE_TRANSACTION_POOL,data:JSON.stringify(F())}},tt=function(t){if(0!==t.length){var n=t[t.length-1];if(pt(n)){var e=st();n.index>e.index?(console.log("blockchain possibly behind. We got: "+e.index+" Peer got: "+n.index),e.hash===n.previousHash?jt(n)&&G(X()):1===t.length?(console.log("We have to query the chain from our peer"),G({type:o.QUERY_ALL,data:null})):(console.log("Received blockchain is longer than current blockchain"),Nt(t))):console.log("received blockchain is not longer than received blockchain. Do nothing")}else console.log("block structuture not valid")}else console.log("received block chain size of 0")},nt=function(){G(X())},et=function(){G(Z())},ot=function t(n,e,o,i,r,u,a){Object(x.a)(this,t),this.index=void 0,this.hash=void 0,this.previousHash=void 0,this.timestamp=void 0,this.data=void 0,this.difficulty=void 0,this.nonce=void 0,this.index=n,this.previousHash=o,this.timestamp=i,this.data=r,this.hash=e,this.difficulty=u,this.nonce=a},it=new ot(0,"91a73664bc84c0baa1fc75ea6e4aa6d1d20c5df664c724e3159aefc2e1186627","",1465154705,[{txIns:[{signature:"",txOutId:"",txOutIndex:0}],txOuts:[{address:"04bfcab8722991ae774db48f934ca79cfb7dd991229153b9f732ba5334aafcd8e7266e47076996b55a14bf9913ee3145ce0cfc1372ada8ada74bd287450313534a",amount:50}],id:"e655f6a5f26dc9b4cac6e46f52336428287759cf81ef5ff10854f69d68f43fa3"}],0,0),rt=[it],ut=j(rt[0].data,[],0),at=function(){return rt},ct=function(){return f.cloneDeep(ut)},lt=function(t){console.log("replacing unspentTxouts with: %s",t),ut=t},st=function(){return rt[rt.length-1]},dt=function(t,n){var e=n[rt.length-10],o=t.timestamp-e.timestamp;return o<50?e.difficulty+1:o>200?e.difficulty-1:e.difficulty},ft=function(){return Math.round((new Date).getTime()/1e3)},xt=function(t){var n=st(),e=function(t){var n=t[rt.length-1];return n.index%10===0&&0!==n.index?dt(n,t):n.difficulty}(at()),o=n.index+1,i=ft(),r=gt(o,n.hash,i,t,e);return jt(r)?(nt(),r):null},ht=function(){var t=[w(U(),st().index+1)].concat(F());return xt(t)},gt=function(t,n,e,o,i){for(var r=0;;){var u=mt(t,n,e,o,i,r);if(kt(u,i))return new ot(t,u,n,e,o,i,r);r++}},vt=function(){return t=U(),n=ct(),f(Y(t,n)).map((function(t){return t.amount})).sum();var t,n},Ot=function(t,n){var e=Q(t,n,H(),ct(),F());return K(e,ct()),et(),e},mt=function(t,n,e,o,i,r){return h.SHA256(t+n+e+o+i+r).toString()},pt=function(t){return"number"===typeof t.index&&"string"===typeof t.hash&&"string"===typeof t.previousHash&&"number"===typeof t.timestamp&&"object"===typeof t.data},yt=function(t,n){return pt(t)?n.index+1!==t.index?(console.log("invalid index"),!1):n.hash!==t.previousHash?(console.log("invalid previoushash"),!1):It(t,n)?!!St(t):(console.log("invalid timestamp"),!1):(console.log("invalid block structure: %s",JSON.stringify(t)),!1)},bt=function(t){return t.map((function(t){return t.difficulty})).map((function(t){return Math.pow(2,t)})).reduce((function(t,n){return t+n}))},It=function(t,n){return n.timestamp-60<t.timestamp&&t.timestamp-60<ft()},St=function(t){return Et(t)?(kt(t.hash,t.difficulty)||console.log("block difficulty not satisfied. Expected: "+t.difficulty+"got: "+t.hash),!0):(console.log("invalid hash, got:"+t.hash),!1)},Et=function(t){return function(t){return mt(t.index,t.previousHash,t.timestamp,t.data,t.difficulty,t.nonce)}(t)===t.hash},kt=function(t,n){var e=function(t){for(var n="",e={0:"0000",1:"0001",2:"0010",3:"0011",4:"0100",5:"0101",6:"0110",7:"0111",8:"1000",9:"1001",a:"1010",b:"1011",c:"1100",d:"1101",e:"1110",f:"1111"},o=0;o<t.length;o+=1){if(!e[t[o]])return null;n+=e[t[o]]}return n}(t),o="0".repeat(n);return e.startsWith(o)},wt=function(t){console.log("isValidChain:"),console.log(JSON.stringify(t));var n;if(n=t[0],JSON.stringify(n)!==JSON.stringify(it))return null;for(var e=[],o=0;o<t.length;o++){var i=t[o];if(0!==o&&!yt(t[o],t[o-1]))return null;if(null===(e=j(i.data,e,i.index)))return console.log("invalid transactions in blockchain"),null}return e},jt=function(t){if(yt(t,st())){var n=j(t.data,ct(),t.index);return null===n?(console.log("block is not valid in terms of transactions"),!1):(rt.push(t),lt(n),q(ut),!0)}return!1},Nt=function(t){var n=wt(t);null!==n&&bt(t)>bt(at())?(console.log("Received blockchain is valid. Replacing current blockchain with received blockchain"),rt=t,lt(n),q(ut),nt()):console.log("Received blockchain invalid")},Pt=e(62),Tt=s()("http://jerry-server.herokuapp.com",{transports:["websocket"]});var At=function(){var t=Object(i.useState)(0),n=Object(c.a)(t,2),e=n[0],o=(n[1],Object(i.useState)(!0)),u=Object(c.a)(o,2),a=u[0],l=u[1],s=Object(Pt.a)(["jerry"]),d=Object(c.a)(s,3),f=d[0],x=d[1],h=d[2],g=Object(i.useState)(""),v=Object(c.a)(g,2),O=v[0],m=v[1],p=Object(i.useState)(),y=Object(c.a)(p,2),b=y[0],I=y[1],S=Object(i.useState)(F()),E=Object(c.a)(S,2),k=E[0],w=E[1],j=Object(i.useState)(""),N=Object(c.a)(j,2),P=N[0],T=N[1],A=Object(i.useState)(0),R=Object(c.a)(A,2),_=R[0],C=R[1],L=Object(i.useState)(at()),J=Object(c.a)(L,2),H=(J[0],J[1]);return Object(i.useEffect)((function(){if(console.log("yeah",f.jerry),a&&(console.log("running first"),Tt.emit("getTxPool"),Tt.emit("getBlockchain"),l(!1)),Tt.on("resTxPool",(function(t){console.log("got pool:",t),W(t),w(t)})),Tt.on("resBlockchain",(function(t){console.log("got bc:",t),t.length>0&&(tt(t),H(t))})),Tt.on("tx",(function(t){console.log("got pool:",t),W(t),w(t)})),Tt.on("bc",(function(t){console.log("got bc:",t),t.length>0&&(tt(t),H(t))})),void 0==f.jerry){var t=B();console.log("making key",t),x("jerry",t),m(U())}else console.log(f.jerry),m(U());return function(){Tt.emit("disconnect")}}),[f,O,a,I,m,h,x]),r.a.createElement(r.a.Fragment,null,r.a.createElement("h1",null," Test "),r.a.createElement("p",null,e),r.a.createElement("input",{type:"text",value:P,onChange:function(t){return T(t.target.value)}}),r.a.createElement("input",{type:"text",value:_,onChange:function(t){var n;n=""==t.target.value?0:parseInt(t.target.value),C(n)}}),r.a.createElement("button",{onClick:function(){ht(),I(vt()),Tt.emit("sendBlockchain",at())}},"generateNextBlock "),r.a.createElement("button",{onClick:function(){Tt.emit("sendTx",Ot(P,_))}}," sendTransaction "),k.forEach((function(t){return r.a.createElement("p",null,"item.id")})),r.a.createElement("p",null," ",O," "),r.a.createElement("p",null," ",b," "),r.a.createElement("p",null," transactionPool: "))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));a.a.render(r.a.createElement(At,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(t){t.unregister()}))},63:function(t,n,e){t.exports=e(147)},68:function(t,n,e){},96:function(t,n){},99:function(t,n,e){t.exports=e.p+"static/media/logo.5d5d9eef.svg"}},[[63,1,2]]]);
//# sourceMappingURL=main.08e3fac6.chunk.js.map