(this.webpackJsonpjerrycoin=this.webpackJsonpjerrycoin||[]).push([[0],{100:function(t,n,e){},102:function(t,n){},103:function(t,n){},147:function(t,n,e){"use strict";e.r(n);var o,i=e(0),r=e.n(i),u=e(59),a=e.n(u),c=(e(68),e(6)),s=e(60),l=e.n(s),f=(e(99),e(100),e(23)),d=(e(35),e(2)),x=e(8),h=e(24),g=new f.ec("secp256k1"),v=function t(n,e,o,i){Object(x.a)(this,t),this.txOutId=void 0,this.txOutIndex=void 0,this.address=void 0,this.amount=void 0,this.txOutId=n,this.txOutIndex=e,this.address=o,this.amount=i},O=function t(){Object(x.a)(this,t),this.txOutId=void 0,this.txOutIndex=void 0,this.signature=void 0},m=function t(n,e){Object(x.a)(this,t),this.address=void 0,this.amount=void 0,this.address=n,this.amount=e},p=function t(){Object(x.a)(this,t),this.id=void 0,this.txIns=void 0,this.txOuts=void 0},y=function(t){var n=t.txIns.map((function(t){return t.txOutId+t.txOutIndex})).reduce((function(t,n){return t+n}),""),e=t.txOuts.map((function(t){return t.address+t.amount})).reduce((function(t,n){return t+n}),"");return h.SHA256(n+e).toString()},I=function(t,n){if(!R(t))return!1;if(y(t)!==t.id)return console.log("invalid tx id: "+t.id),!1;if(!t.txIns.map((function(e){return S(e,t,n)})).reduce((function(t,n){return t&&n}),!0))return console.log("some of the txIns are invalid in tx: "+t.id),!1;var e=t.txIns.map((function(t){return E(t,n)})).reduce((function(t,n){return t+n}),0);return t.txOuts.map((function(t){return t.amount})).reduce((function(t,n){return t+n}),0)===e||(console.log("totalTxOutValues !== totalTxInValues in tx: "+t.id),!1)},b=function(t,n){return null==t?(console.log("the first transaction in the block must be coinbase transaction"),!1):y(t)!==t.id?(console.log("invalid coinbase tx id: "+t.id),!1):1===t.txIns.length?t.txIns[0].txOutIndex!==n?(console.log("the txIn signature in coinbase tx must be the block height"),!1):1!==t.txOuts.length?(console.log("invalid number of txOuts in coinbase transaction"),!1):50===t.txOuts[0].amount||(console.log("invalid coinbase amount in coinbase transaction"),!1):void console.log("one txIn must be specified in the coinbase transaction")},S=function(t,n,e){var o=e.find((function(n){return n.txOutId===t.txOutId&&n.txOutIndex===t.txOutIndex}));if(null==o)return console.log("referenced txOut not found: "+JSON.stringify(t)),!1;var i=o.address;return!!g.keyFromPublic(i,"hex").verify(n.id,t.signature)||(console.log("invalid txIn signature: %s txId: %s address: %s",t.signature,n.id,o.address),!1)},E=function(t,n){return w(t.txOutId,t.txOutIndex,n).amount},w=function(t,n,e){return e.find((function(e){return e.txOutId===t&&e.txOutIndex===n}))},j=function(t,n){var e=new p,o=new O;return o.signature="",o.txOutId="",o.txOutIndex=n,e.txIns=[o],e.txOuts=[new m(t,50)],e.id=y(e),e},N=function(t,n,e){return function(t,n,e){var o=t[0];return b(o,e)?t.slice(1).map((function(t){return I(t,n)})).reduce((function(t,n){return t&&n}),!0):(console.log("invalid coinbase transaction: "+JSON.stringify(o)),!1)}(t,n,e)?function(t,n){var e=t.map((function(t){return t.txOuts.map((function(n,e){return new v(t.id,e,n.address,n.amount)}))})).reduce((function(t,n){return t.concat(n)}),[]),o=t.map((function(t){return t.txIns})).reduce((function(t,n){return t.concat(n)}),[]).map((function(t){return new v(t.txOutId,t.txOutIndex,"",0)}));return n.filter((function(t){return!w(t.txOutId,t.txOutIndex,o)})).concat(e)}(t,n):(console.log("invalid block transactions"),null)},k=function(t){return Array.from(t,(function(t){return("0"+(255&t).toString(16)).slice(-2)})).join("")},T=function(t){return g.keyFromPrivate(t,"hex").getPublic().encode("hex")},P=function(t){return null==t?(console.log("txIn is null"),!1):"string"!==typeof t.signature?(console.log("invalid signature type in txIn"),!1):"string"!==typeof t.txOutId?(console.log("invalid txOutId type in txIn"),!1):"number"===typeof t.txOutIndex||(console.log("invalid txOutIndex type in txIn"),!1)},A=function(t){return null==t?(console.log("txOut is null"),!1):"string"!==typeof t.address?(console.log("invalid address type in txOut"),!1):_(t.address)?"number"===typeof t.amount||(console.log("invalid amount type in txOut"),!1):(console.log("invalid TxOut address"),!1)},R=function(t){return"string"!==typeof t.id?(console.log("transactionId missing"),!1):t.txIns instanceof Array?!!t.txIns.map(P).reduce((function(t,n){return t&&n}),!0)&&(t.txOuts instanceof Array?!!t.txOuts.map(A).reduce((function(t,n){return t&&n}),!0):(console.log("invalid txIns type in transaction"),!1)):(console.log("invalid txIns type in transaction"),!1)},_=function(t){return 130!==t.length?(console.log(t),console.log("invalid public key length"),!0):null===t.match("^[a-fA-F0-9]+$")?(console.log("public key must contain only hex characters"),!1):!!t.startsWith("04")||(console.log("public key must start with 04"),!1)},C=e(61),L=e.n(C),J=new f.ec("secp256k1"),B=(Object({NODE_ENV:"production",PUBLIC_URL:"/jerrycoin"}).PRIVATE_KEY,function(){var t=L.a.get("jerry");return console.log(t),t}),H=function(){var t=B(),n=J.keyFromPrivate(t,"hex");return console.log(n.getPublic()),n.getPublic().encode("hex")},U=function(){return J.genKeyPair().getPrivate().toString(16)},Y=function(t,n){return d.filter(n,(function(n){return n.address===t}))},F=function(t,n,e,o,i){console.log("txPool: %s",JSON.stringify(i));var r=T(e),u=function(t,n){var e=0,o=[],i=!0,r=!1,u=void 0;try{for(var a,c=n[Symbol.iterator]();!(i=(a=c.next()).done);i=!0){var s=a.value;if(o.push(s),(e+=s.amount)>=t)return{includedUnspentTxOuts:o,leftOverAmount:e-t}}}catch(f){r=!0,u=f}finally{try{i||null==c.return||c.return()}finally{if(r)throw u}}var l="Cannot create transaction from the available unspent transaction outputs. Required amount:"+t+". Available unspentTxOuts:"+JSON.stringify(n);throw Error(l)}(n,function(t,n){var e=d(n).map((function(t){return t.txIns})).flatten().value(),o=[],i=!0,r=!1,u=void 0;try{for(var a,c=function(){var t=a.value;void 0===d.find(e,(function(n){return n.txOutIndex===t.txOutIndex&&n.txOutId===t.txOutId}))||o.push(t)},s=t[Symbol.iterator]();!(i=(a=s.next()).done);i=!0)c()}catch(l){r=!0,u=l}finally{try{i||null==s.return||s.return()}finally{if(r)throw u}}return d.without.apply(d,[t].concat(o))}(o.filter((function(t){return t.address===r})),i)),a=u.includedUnspentTxOuts,c=u.leftOverAmount,s=a.map((function(t){var n=new O;return n.txOutId=t.txOutId,n.txOutIndex=t.txOutIndex,n})),l=new p;return l.txIns=s,l.txOuts=function(t,n,e,o){var i=new m(t,e);return 0===o?[i]:[i,new m(n,o)]}(t,r,n,c),l.id=y(l),l.txIns=l.txIns.map((function(t,n){return t.signature=function(t,n,e,o){var i=t.txIns[n],r=t.id,u=w(i.txOutId,i.txOutIndex,o);if(null==u)throw console.log("could not find referenced txOut"),Error();var a=u.address;if(T(e)!==a)throw console.log("trying to sign an input with private key that does not match the address that is referenced in txIn"),Error();var c=g.keyFromPrivate(e,"hex");return k(c.sign(r).toDER())}(l,n,e,o),t})),l},Q=(e(36),[]),D=function(){return d.cloneDeep(Q)},K=function(t){Q=t},V=function(t,n){if(!I(t,n))throw Error("Trying to add invalid tx to pool");if(!q(t,Q))throw Error("Trying to add invalid tx to pool");console.log("adding to txPool: %s",JSON.stringify(t)),Q.push(t)},W=function(t,n){return void 0!==n.find((function(n){return n.txOutId===t.txOutId&&n.txOutIndex===t.txOutIndex}))},$=function(t){var n=[],e=!0,o=!1,i=void 0;try{for(var r,u=Q[Symbol.iterator]();!(e=(r=u.next()).done);e=!0){var a=r.value,c=!0,s=!1,l=void 0;try{for(var f,x=a.txIns[Symbol.iterator]();!(c=(f=x.next()).done);c=!0){var h=f.value;if(!W(h,t)){n.push(a);break}}}catch(g){s=!0,l=g}finally{try{c||null==x.return||x.return()}finally{if(s)throw l}}}}catch(g){o=!0,i=g}finally{try{e||null==u.return||u.return()}finally{if(o)throw i}}n.length>0&&(console.log("removing the following transactions from txPool: %s",JSON.stringify(n)),Q=d.without.apply(d,[Q].concat(n)))},q=function(t,n){var e=d(n).map((function(t){return t.txIns})).flatten().value(),o=function(t,n){return d.find(e,(function(t){return n.txOutIndex===t.txOutIndex&&n.txOutId===t.txOutId}))},i=!0,r=!1,u=void 0;try{for(var a,c=t.txIns[Symbol.iterator]();!(i=(a=c.next()).done);i=!0){if(o(0,a.value))return console.log("txIn already found in the txPool"),!1}}catch(s){r=!0,u=s}finally{try{i||null==c.return||c.return()}finally{if(r)throw u}}return!0},M=[];!function(t){t[t.QUERY_LATEST=0]="QUERY_LATEST",t[t.QUERY_ALL=1]="QUERY_ALL",t[t.RESPONSE_BLOCKCHAIN=2]="RESPONSE_BLOCKCHAIN",t[t.QUERY_TRANSACTION_POOL=3]="QUERY_TRANSACTION_POOL",t[t.RESPONSE_TRANSACTION_POOL=4]="RESPONSE_TRANSACTION_POOL"}(o||(o={}));var z=function(t,n){return t.send(JSON.stringify(n))},G=function(t){return M.forEach((function(n){return z(n,t)}))},X=function(){return{type:o.RESPONSE_BLOCKCHAIN,data:JSON.stringify([lt()])}},Z=function(){return{type:o.RESPONSE_TRANSACTION_POOL,data:JSON.stringify(D())}},tt=function(){G(X())},nt=function(){G(Z())},et=function t(n,e,o,i,r,u,a){Object(x.a)(this,t),this.index=void 0,this.hash=void 0,this.previousHash=void 0,this.timestamp=void 0,this.data=void 0,this.difficulty=void 0,this.nonce=void 0,this.index=n,this.previousHash=o,this.timestamp=i,this.data=r,this.hash=e,this.difficulty=u,this.nonce=a},ot=new et(0,"91a73664bc84c0baa1fc75ea6e4aa6d1d20c5df664c724e3159aefc2e1186627","",1465154705,[{txIns:[{signature:"",txOutId:"",txOutIndex:0}],txOuts:[{address:"04bfcab8722991ae774db48f934ca79cfb7dd991229153b9f732ba5334aafcd8e7266e47076996b55a14bf9913ee3145ce0cfc1372ada8ada74bd287450313534a",amount:50}],id:"e655f6a5f26dc9b4cac6e46f52336428287759cf81ef5ff10854f69d68f43fa3"}],0,0),it=[ot],rt=N(it[0].data,[],0),ut=function(){return it},at=function(t){rt=wt(it=t)},ct=function(){return d.cloneDeep(rt)},st=function(t){console.log("replacing unspentTxouts with: %s",t),rt=t},lt=function(){return it[it.length-1]},ft=function(t,n){var e=n[it.length-10],o=t.timestamp-e.timestamp;return o<50?e.difficulty+1:o>200?e.difficulty-1:e.difficulty},dt=function(){return Math.round((new Date).getTime()/1e3)},xt=function(t){var n=lt(),e=function(t){var n=t[it.length-1];return n.index%10===0&&0!==n.index?ft(n,t):n.difficulty}(ut()),o=n.index+1,i=dt(),r=gt(o,n.hash,i,t,e);return jt(r)?(tt(),r):null},ht=function(){var t=[j(H(),lt().index+1)].concat(D());return xt(t)},gt=function(t,n,e,o,i){for(var r=0;;){var u=mt(t,n,e,o,i,r);if(Et(u,i))return new et(t,u,n,e,o,i,r);r++}},vt=function(){return t=H(),n=ct(),d(Y(t,n)).map((function(t){return t.amount})).sum();var t,n},Ot=function(t,n){var e=F(t,n,B(),ct(),D());return V(e,ct()),nt(),e},mt=function(t,n,e,o,i,r){return h.SHA256(t+n+e+o+i+r).toString()},pt=function(t){return"number"===typeof t.index&&"string"===typeof t.hash&&"string"===typeof t.previousHash&&"number"===typeof t.timestamp&&"object"===typeof t.data},yt=function(t,n){return pt(t)?n.index+1!==t.index?(console.log("invalid index"),!1):n.hash!==t.previousHash?(console.log("invalid previoushash"),!1):It(t,n)?!!bt(t):(console.log("invalid timestamp"),!1):(console.log("invalid block structure: %s",JSON.stringify(t)),!1)},It=function(t,n){return n.timestamp-60<t.timestamp&&t.timestamp-60<dt()},bt=function(t){return St(t)?(Et(t.hash,t.difficulty)||console.log("block difficulty not satisfied. Expected: "+t.difficulty+"got: "+t.hash),!0):(console.log("invalid hash, got:"+t.hash),!1)},St=function(t){return function(t){return mt(t.index,t.previousHash,t.timestamp,t.data,t.difficulty,t.nonce)}(t)===t.hash},Et=function(t,n){var e=function(t){for(var n="",e={0:"0000",1:"0001",2:"0010",3:"0011",4:"0100",5:"0101",6:"0110",7:"0111",8:"1000",9:"1001",a:"1010",b:"1011",c:"1100",d:"1101",e:"1110",f:"1111"},o=0;o<t.length;o+=1){if(!e[t[o]])return null;n+=e[t[o]]}return n}(t),o="0".repeat(n);return e.startsWith(o)},wt=function(t){console.log("isValidChain:"),console.log(JSON.stringify(t));var n;if(n=t[0],JSON.stringify(n)!==JSON.stringify(ot))return null;for(var e=[],o=0;o<t.length;o++){var i=t[o];if(0!==o&&!yt(t[o],t[o-1]))return null;if(null===(e=N(i.data,e,i.index)))return console.log("invalid transactions in blockchain"),null}return e},jt=function(t){if(yt(t,lt())){var n=N(t.data,ct(),t.index);return null===n?(console.log("block is not valid in terms of transactions"),!1):(it.push(t),st(n),$(rt),!0)}return!1},Nt=e(62);var kt=function(){var t=Object(i.useState)(0),n=Object(c.a)(t,2),e=n[0],o=(n[1],Object(i.useState)(!0)),u=Object(c.a)(o,2),a=u[0],s=u[1],f=Object(Nt.a)(["jerry"]),d=Object(c.a)(f,3),x=d[0],h=d[1],g=d[2],v=Object(i.useState)(""),O=Object(c.a)(v,2),m=O[0],p=O[1],y=Object(i.useState)(),I=Object(c.a)(y,2),b=I[0],S=I[1],E=Object(i.useState)(D()),w=Object(c.a)(E,2),j=w[0],N=w[1],k=Object(i.useState)(""),T=Object(c.a)(k,2),P=T[0],A=T[1],R=Object(i.useState)(0),_=Object(c.a)(R,2),C=_[0],L=_[1],J=Object(i.useState)(ut()),B=Object(c.a)(J,2),Y=(B[0],B[1]),F=l()("http://jerry-server.herokuapp.com");return Object(i.useEffect)((function(){if(console.log("yeah",x.jerry),a&&(console.log("running first"),F.emit("getTxPool"),F.emit("getBlockchain"),s(!1)),F.on("resTxPool",(function(t){console.log("got pool:",t),K(t),N(t)})),F.on("resBlockchain",(function(t){console.log("got bc:",t),t.length>0&&(at(t),Y(t))})),F.on("tx",(function(t){console.log("got pool:",t),K(t),N(t)})),F.on("bc",(function(t){console.log("got bc:",t),t.length>0&&(at(t),Y(t))})),void 0==x.jerry){var t=U();console.log("making key",t),h("jerry",t),p(H())}else console.log(x.jerry),p(H());return function(){F.emit("disconnect")}}),[x,m,a,S,p,g,h,F]),r.a.createElement(r.a.Fragment,null,r.a.createElement("h1",null," Test "),r.a.createElement("p",null,e),r.a.createElement("input",{type:"text",value:P,onChange:function(t){return A(t.target.value)}}),r.a.createElement("input",{type:"text",value:C,onChange:function(t){var n;n=""==t.target.value?0:parseInt(t.target.value),L(n)}}),r.a.createElement("button",{onClick:function(){ht(),S(vt()),F.emit("sendBlockchain",ut())}},"generateNextBlock "),r.a.createElement("button",{onClick:function(){F.emit("sendTx",Ot(P,C))}}," sendTransaction "),j.forEach((function(t){return r.a.createElement("p",null,"item.id")})),r.a.createElement("p",null," ",m," "),r.a.createElement("p",null," ",b," "),r.a.createElement("p",null," transactionPool: "))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));a.a.render(r.a.createElement(kt,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(t){t.unregister()}))},63:function(t,n,e){t.exports=e(147)},68:function(t,n,e){},96:function(t,n){},99:function(t,n,e){t.exports=e.p+"static/media/logo.5d5d9eef.svg"}},[[63,1,2]]]);
//# sourceMappingURL=main.33a0d6ae.chunk.js.map